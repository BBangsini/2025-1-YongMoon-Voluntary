<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë°©ì‹ ìš° ë¸”ë¡œê·¸ ê²Œì„</title>
  <style>
    body {
      margin: 0;
      background-color: #111;
      font-family: sans-serif;ã…‡ã„´
      color: white;
      overflow: hidden;
    }

    canvas {
      background-color: #222;
      display: block;
      margin: 50px auto 0 auto;
      border: 1px solid #444;
    }

    #topNotice {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: #ffcc00;
      font-weight: bold;
      font-size: 18px;
      z-index: 20;
      user-select: none;
    }

    #battleBox, #infoBox {
      position: absolute;
      top: 100px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      border: 2px solid #999;
      padding: 20px;
      z-index: 10;
      display: none;
      color: white;
      box-sizing: border-box;
      border-radius: 8px;
      font-size: 14px;
      max-width: 90vw;
    }

    #battleBox {
      width: 320px;
    }

    #infoBox {
      width: 520px;
      top: 80px;
    }

    #battleBox button {
      margin: 5px 10px 5px 0;
      padding: 10px 14px;
      background-color: #555;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    #battleBox button:hover {
      background-color: #777;
    }

    #battleLog {
      margin-top: 10px;
      min-height: 40px;
      color: #ccc;
      white-space: pre-wrap;
    }

    #closeInfo {
      margin-top: 15px;
      padding: 6px 14px;
      background: #666;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 4px;
      float: right;
      transition: background-color 0.2s;
    }
    #closeInfo:hover {
      background-color: #888;
    }
  </style>
</head>
<body>

<div id="topNotice">*ë°©ì‹ ìš°ì˜ ë¸”ë¡œê·¸*  ğŸ›¡ï¸ ëª¬ìŠ¤í„°ë¥¼ ì²˜ì¹˜í•´ì•¼ ê²Œì‹œë¬¼ì„ ì—´ëŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. wasdë¡œ ì›€ì§ì´ì„¸ìš”.</div>

<canvas id="gameCanvas" width="800" height="500"></canvas>

<!-- ì „íˆ¬ì°½ -->
<div id="battleBox">
  <div id="battleInfo"></div>
  <div>ğŸ’ ì•„ì´í…œ ìˆ˜: <span id="itemCount">0</span></div>
  <button onclick="attack()">ê³µê²©</button>
  <button onclick="useItem()">ì•„ì´í…œ</button>
  <button onclick="runAway()">ë„ë§</button>
  <div id="battleLog"></div>
</div>

<!-- ì„¤ëª…ì°½ -->
<div id="infoBox">
  <h2 id="infoTitle">ê²Œì‹œë¬¼ ì œëª©</h2>
  <p id="infoDescription">ê²Œì‹œë¬¼ ì„¤ëª…ì€ ì—¬ê¸°ì— ë“¤ì–´ê°ˆ ì˜ˆì •ì…ë‹ˆë‹¤.</p>
  <button id="closeInfo" onclick="closeInfo()">ë‹«ê¸°</button>
</div>

<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  let player = { x: 100, y: 100, size: 30, hp: 20, items: 0 };
  const speed = 4.5;

  const posts = [
    {
      x: 150,
      y: 100,
      title: "ì¢‹ì•„í•˜ëŠ”ê²ƒ",
      description: "ì¢‹ì•„í•˜ëŠ”ê²ƒ: ê²Œì„, ì²´ìœ¡, ì• ë‹ˆë©”ì´ì…˜, ì»´í“¨í„°, ìŒì•…, ì†Œì„¤ì±…, ì¹˜í‚¨",
      unlocked: false,
    },
    {
      x: 350,
      y: 250,
      title: "ì‹«ì–´í•˜ëŠ” ê²ƒ",
      description: "ì‹«ì–´í•˜ëŠ”ê²ƒ: í† ë§ˆí† , ë¥ê³  ìŠµí•œ ë‚ ì”¨",
      unlocked: false,
    },
    {
      x: 600,
      y: 100,
      title: "ë‚´ ì·¨ë¯¸",
      description: "ì·¨ë¯¸: ìŠ¤ì¼€ì´íŠ¸(ë‚˜ë¦„ ì „ ì„ ì¶œ), ë¡¤(ìš”ì¦˜ ì•ˆí•¨), ë°œë¡œë€íŠ¸(ìš”ì¦˜ ìì£¼í•¨), ê·¸ ì™¸ ì½˜ì†”ê²Œì„ë„ ì¦ê²¨í•¨",
      unlocked: false,
    },
  ];

  const monsters = [
    { x: 150, y: 160, name: "ëª¬ìŠ¤í„° A", hp: 20, alive: true },
    { x: 350, y: 310, name: "ëª¬ìŠ¤í„° B", hp: 20, alive: true },
    { x: 600, y: 160, name: "ëª¬ìŠ¤í„° C", hp: 20, alive: true },
  ];

  let keys = {};
  let inBattle = false;
  let inInfo = false;
  let currentMonster = null;

  document.addEventListener("keydown", (e) => {
    keys[e.key.toLowerCase()] = true;
  });
  document.addEventListener("keyup", (e) => {
    keys[e.key.toLowerCase()] = false;
  });

  function movePlayer() {
    if (inBattle) return;  // ì „íˆ¬ì¤‘ì¼ ë•Œë§Œ ì´ë™ ì œí•œ

    if (keys["w"] || keys["arrowup"]) player.y -= speed;
    if (keys["s"] || keys["arrowdown"]) player.y += speed;
    if (keys["a"] || keys["arrowleft"]) player.x -= speed;
    if (keys["d"] || keys["arrowright"]) player.x += speed;

    player.x = Math.max(0, Math.min(canvas.width - player.size, player.x));
    player.y = Math.max(0, Math.min(canvas.height - player.size, player.y));
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.font = "16px sans-serif";
    ctx.textBaseline = "middle";

    posts.forEach((post) => {
      ctx.fillStyle = post.unlocked ? "#88f" : "#555";
      ctx.fillRect(post.x, post.y, 100, 40);
      ctx.fillStyle = "white";
      ctx.fillText(post.title, post.x + 10, post.y + 20);
    });

    monsters.forEach((mon) => {
      if (!mon.alive) return;
      ctx.fillStyle = "#aa4444";
      ctx.fillRect(mon.x, mon.y, 100, 40);
      ctx.fillStyle = "white";
      ctx.fillText(mon.name, mon.x + 10, mon.y + 20);
    });

    ctx.fillStyle = "#4af";
    ctx.fillRect(player.x, player.y, player.size, player.size);
  }

  function checkCollision() {
    if (inBattle) return;

    monsters.forEach((mon) => {
      if (!mon.alive) return;
      if (
        player.x < mon.x + 100 &&
        player.x + player.size > mon.x &&
        player.y < mon.y + 40 &&
        player.y + player.size > mon.y
      ) {
        enterBattle(mon);
      }
    });

    posts.forEach((post) => {
      if (
        player.x < post.x + 100 &&
        player.x + player.size > post.x &&
        player.y < post.y + 40 &&
        player.y + player.size > post.y
      ) {
        if (post.unlocked) {
          showInfo(post);
        }
      }
    });
  }

  function enterBattle(mon) {
    inBattle = true;
    currentMonster = mon;
    document.getElementById("battleBox").style.display = "block";
    updateBattleInfo();
  }

  function updateBattleInfo() {
    if (!currentMonster) return;
    document.getElementById("battleInfo").innerHTML =
      `ğŸ§â€â™‚ï¸ í”Œë ˆì´ì–´ HP: ${player.hp} <br> ğŸ‘¾ ${currentMonster.name} HP: ${currentMonster.hp}`;
    document.getElementById("itemCount").textContent = player.items;
  }

  function attack() {
    if (!inBattle) return;

    const dmg = Math.floor(Math.random() * 5) + 5;
    currentMonster.hp -= dmg;
    log(`í”Œë ˆì´ì–´ì˜ ê³µê²©! ${dmg}ì˜ ë°ë¯¸ì§€!`);

    if (currentMonster.hp <= 0) {
      log(`${currentMonster.name} ì²˜ì¹˜! ì•„ì´í…œ íšë“! ì•„ì´í…œì„ ì‚¬ìš©í•´ HPë¥¼ íšŒë³µí•˜ì„¸ìš”!`);
      currentMonster.alive = false;
      player.items += 1;

      const index = monsters.indexOf(currentMonster);
      if (posts[index]) {
        posts[index].unlocked = true;
      }

      currentMonster.hp = 0;
      endBattle();
      return;
    }

    monsterAttack();
  }

  function monsterAttack() {
    if (!inBattle) return;

    const dmg = Math.floor(Math.random() * 3) + 2;
    player.hp -= dmg;
    log(`${currentMonster.name}ì˜ ë°˜ê²©! ${dmg}ì˜ í”¼í•´!`);

    if (player.hp <= 0) {
      log("í”Œë ˆì´ì–´ê°€ ì“°ëŸ¬ì¡ŒìŠµë‹ˆë‹¤... ê²Œì„ ì˜¤ë²„!");
      endBattle();
    }

    updateBattleInfo();
  }

  function useItem() {
    if (!inBattle) return;

    if (player.items > 0 && player.hp < 20) {
      player.hp = Math.min(player.hp + 10, 20);
      player.items -= 1;
      log("ì•„ì´í…œ ì‚¬ìš©! HP 10 íšŒë³µ!");
    } else {
      log("ì•„ì´í…œì´ ì—†ê±°ë‚˜ ì²´ë ¥ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.");
    }
    monsterAttack();
  }

  function runAway() {
    if (!inBattle) return;

    log("ë„ë§ì³¤ìŠµë‹ˆë‹¤!");

    if (currentMonster) {
      player.x = currentMonster.x - player.size - 10;
      player.y = currentMonster.y;

      player.x = Math.max(0, Math.min(canvas.width - player.size, player.x));
      player.y = Math.max(0, Math.min(canvas.height - player.size, player.y));
    }

    endBattle();
  }

  function log(msg) {
    const battleLog = document.getElementById("battleLog");
    battleLog.innerHTML = msg;
  }

  function endBattle() {
    inBattle = false;
    currentMonster = null;
    document.getElementById("battleBox").style.display = "none";
    updateBattleInfo();
  }

  function showInfo(post) {
    inInfo = true;
    document.getElementById("infoTitle").textContent = post.title;
    document.getElementById("infoDescription").textContent = post.description;
    document.getElementById("infoBox").style.display = "block";
  }

  function closeInfo() {
    inInfo = false;
    document.getElementById("infoBox").style.display = "none";
  }

  function gameLoop() {
    movePlayer();
    draw();
    checkCollision();
    requestAnimationFrame(gameLoop);
  }

  gameLoop();
</script>

</body>
</html>
